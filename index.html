<html lang="baike">
	<head>
		<title>20-20-20 rule</title>
	</head>
	<body id = 'body'>
		<audio src="就是现在20s.mp3" id="audio_0" preload="auto"></audio>
		<audio src="就是现在40s.mp3" id="audio_end" preload="auto"></audio>
		<div class="main">
			<h1 style="margin:0;color:#66ccff; font-size: 40pt">20-20-20 rule</h1>
			<h1 id='timer0' style="margin:0;font-size: 80pt;color:#66ffcc">working timer</h1>
			<!-- 'timer0' 上面的计时器 -->
			<button id="btn1" onclick="pause()">Pause & restart</button>
			<button id='rest' onclick="rest()">rest for 10 min</button>
			<h1 id='timer1' style="color:#aa66cc; font-size: 50pt">after timer</h1>
			<button id='pop' onclick="pop()">test pop</button>
		</div>
		<script>
			var r = Math.floor(Math.random() * 256)
			var g = Math.floor(Math.random() * 256)
			var b = Math.floor(Math.random() * 256)
			var color = "rgb(" + r + "," + g + "," + b + ")"; 
			var bd = document.getElementById("body")    
			bd.style.background = color;
		</script>
		<script>
			var t = 60 * 60	
			t = 5
			var flag = 0;   
			var t1 = 0, timer0, timer1
			var m0 = document.getElementById('audio_0')
			var m1 = document.getElementById('audio_end')
			timer0 = setInterval("t--;main(t)", 1000);	
			console.log("雨声残响，随风流离")
			function main(x = 0) {	
				document.getElementById("timer0").innerHTML = Math.trunc(x / 3600) + ':' + Math.trunc(x / 60) % 60 + ':' + x % 60;	
				if (x == 40 * 60 || x == 20 * 60) {
					pop_alert();
					m0.play()
				}
				if (x == 0 && flag == 0) {
					m1.play()
					pop_alert();
					flag++;
					timer1 = setInterval("t1 = show1(t1)", 1000);
					t = 10 * 60;   
				}
				else if (x == 0 && flag == 1) {
					clearInterval(timer0)
					document.getElementById('audio_0').play();
					pop_alert();
					setTimeout('window.location.reload()', 21000) //21秒后刷新
				}
			}
			//超时正计时器  
			function show1(t = 0) {
				t++
				document.getElementById("timer1").innerHTML = Math.trunc(t / 3600) + ':' + Math.trunc(t / 60) % 60 + ':' + t % 60;
				return t
			}
			//alert function
			function pop_alert() {
				var me = window.open('20v3弹窗计时器.html',
					'_blank',
					'width=2500,height=1600 top=0,left=0');//set size
				setTimeout(function () {me.close()}, 21 * 1000);  
			}
			//开始休息按钮
			rest = function () {
				clearInterval(timer0);
				clearInterval(timer1);
				document.getElementById("timer1").innerHTML = 'rest'
				t = 10 * 60
				timer0 = setInterval(";t--;main(t)", 1000);	
				flagP = 0
			}
			//button pop
			pop = function () {
				pop_alert();
			}
			//button Pause
			var flagP = 0
			pause = function () {
				if (flagP % 2 == 0) {
					clearInterval(timer0);
					document.getElementById("timer1").innerHTML = 'pause'
				}
				else {
					clearInterval(timer0)	//更加稳妥,防止bug
					timer0 = setInterval(";t--;main(t)", 1000);
					document.getElementById("timer1").innerHTML = 'after timer'
				}
				flagP += 1
			}
		</script>
	</body>
</html>
